<!DOCTYPE html>
<html>
<head>
    <title>Harry's Firebolt WebSocket Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .prompt-panel {
            display: flex;
            flex-direction: column;
        }
        .result-panel {
            display: flex;
            flex-direction: column;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        #messages {
            height: 200px;
            border: 1px solid #e0e0e0;
            margin: 10px 0;
            padding: 10px;
            overflow-y: auto;
            background-color: #fafafa;
            border-radius: 4px;
        }
        .message {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .sent {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .received {
            background-color: #f1f8e9;
            border-left: 4px solid #4caf50;
        }
        .error {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
            font-size: 1em;
        }
        textarea:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
        }
        button {
            padding: 12px 24px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #1976d2;
        }
        button:disabled {
            background-color: #bdbdbd;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
            font-weight: 500;
        }
        .connected {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .disconnected {
            background-color: #ffebee;
            color: #c62828;
        }
        .enhanced-content {
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            margin-top: 10px;
        }
        .enhancement-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .formatting {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .clarity {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        .structure {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .metadata {
            margin-top: 15px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .validation-results {
            margin-top: 15px;
        }
        .validation-item {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .error-item {
            background-color: #ffebee;
            color: #c62828;
        }
        .warning-item {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        .suggestion-item {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <h1>Harry's Firebolt WebSocket Test</h1>
    <div id="status" class="status disconnected">Disconnected</div>
    
    <div class="container">
        <div class="panel prompt-panel">
            <h2>Input Prompt</h2>
            <textarea id="prompt" placeholder="Enter your prompt here..."></textarea>
            <button onclick="sendPrompt()" id="sendButton">Send Prompt</button>
            <div id="messages"></div>
        </div>
        
        <div class="panel result-panel">
            <h2>Enhanced Prompt</h2>
            <div id="enhancementTypes"></div>
            <div id="enhancedContent" class="enhanced-content"></div>
            <div id="metadata" class="metadata"></div>
            <div id="validationResults" class="validation-results"></div>
        </div>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:3007');
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        const promptTextarea = document.getElementById('prompt');
        const sendButton = document.getElementById('sendButton');
        const enhancedContent = document.getElementById('enhancedContent');
        const enhancementTypes = document.getElementById('enhancementTypes');
        const metadataDiv = document.getElementById('metadata');
        const validationResults = document.getElementById('validationResults');

        ws.onopen = () => {
            statusDiv.textContent = 'Connected';
            statusDiv.className = 'status connected';
            addMessage('System', 'Connected to WebSocket server', 'received');
            sendButton.disabled = false;
        };

        ws.onclose = () => {
            statusDiv.textContent = 'Disconnected';
            statusDiv.className = 'status disconnected';
            addMessage('System', 'Disconnected from WebSocket server', 'error');
            sendButton.disabled = true;
        };

        ws.onerror = (error) => {
            addMessage('Error', 'WebSocket error occurred', 'error');
            console.error('WebSocket error:', error);
        };

        ws.onmessage = (event) => {
            try {
                const response = JSON.parse(event.data);
                addMessage('Server', 'Received enhanced prompt', 'received');
                displayEnhancedPrompt(response);
            } catch (error) {
                addMessage('Error', 'Failed to parse server response', 'error');
            }
        };

        function sendPrompt() {
            const prompt = promptTextarea.value.trim();
            if (!prompt) {
                addMessage('Error', 'Please enter a prompt', 'error');
                return;
            }

            const message = {
                prompt: prompt
            };

            ws.send(JSON.stringify(message));
            addMessage('Client', 'Sent prompt for enhancement', 'sent');
            promptTextarea.value = '';
        }

        function addMessage(sender, message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function displayEnhancedPrompt(response) {
            // Display enhancement types
            enhancementTypes.innerHTML = `
                <span class="enhancement-type formatting">Formatting</span>
                <span class="enhancement-type clarity">Clarity</span>
                <span class="enhancement-type structure">Structure</span>
            `;

            // Display enhanced content
            enhancedContent.textContent = response.enhanced;

            // Display metadata
            metadataDiv.innerHTML = `
                <strong>ID:</strong> ${response.metadata.id}<br>
                <strong>Timestamp:</strong> ${new Date(response.metadata.timestamp).toLocaleString()}<br>
                <strong>Version:</strong> ${response.metadata.version}<br>
                <strong>Source:</strong> ${response.metadata.source}
            `;

            // Display validation results
            validationResults.innerHTML = '';
            
            if (response.validation.errors.length > 0) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'validation-item error-item';
                errorDiv.innerHTML = `<strong>Errors:</strong><br>${response.validation.errors.join('<br>')}`;
                validationResults.appendChild(errorDiv);
            }

            if (response.validation.warnings.length > 0) {
                const warningDiv = document.createElement('div');
                warningDiv.className = 'validation-item warning-item';
                warningDiv.innerHTML = `<strong>Warnings:</strong><br>${response.validation.warnings.join('<br>')}`;
                validationResults.appendChild(warningDiv);
            }

            if (response.validation.suggestions.length > 0) {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.className = 'validation-item suggestion-item';
                suggestionDiv.innerHTML = `<strong>Suggestions:</strong><br>${response.validation.suggestions.join('<br>')}`;
                validationResults.appendChild(suggestionDiv);
            }
        }

        // Enable/disable send button based on connection status
        sendButton.disabled = true;
    </script>
</body>
</html> 